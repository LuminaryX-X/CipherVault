<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CipherVault | Secure Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg0:#020617; /* slate-950 */
      --bg1:#0b1220;
      --glass: rgba(17, 24, 39, .58);
      --stroke: rgba(255,255,255,.08);
      --glow: 0 0 30px rgba(59,130,246,.22);
      --glowG: 0 0 30px rgba(16,185,129,.18);
    }

    body{
      background:
        radial-gradient(1200px 700px at 50% 0%, rgba(59,130,246,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 30%, rgba(16,185,129,.14), transparent 55%),
        radial-gradient(1000px 700px at 10% 40%, rgba(14,165,233,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height: 100vh;
    }

    .glass{
      background: var(--glass);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid var(--stroke);
      box-shadow: 0 20px 80px rgba(0,0,0,.35);
    }

    .ring-soft{
      outline: none;
      border: 1px solid rgba(148,163,184,.20);
    }
    .ring-soft:focus{
      border-color: rgba(59,130,246,.85);
      box-shadow: 0 0 0 4px rgba(59,130,246,.16), var(--glow);
    }

    .ring-soft-green:focus{
      border-color: rgba(16,185,129,.85);
      box-shadow: 0 0 0 4px rgba(16,185,129,.14), var(--glowG);
    }

    /* subtle animated grid */
    .grid-overlay{
      background-image:
        linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size: 40px 40px;
      mask-image: radial-gradient(ellipse at top, rgba(0,0,0,.75), transparent 65%);
      opacity: .35;
      pointer-events: none;
    }

    /* scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #050b16; }
    ::-webkit-scrollbar-thumb { background: rgba(59,130,246,.65); border-radius: 10px; }

    @keyframes floaty {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    .floaty { animation: floaty 6s ease-in-out infinite; }

    @keyframes pop {
      0%{ transform: translateY(8px); opacity: 0; }
      100%{ transform: translateY(0); opacity: 1; }
    }
    .toast-in { animation: pop .25s ease-out; }

    /* spinner */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner{
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,.25);
      border-top-color: rgba(255,255,255,.9);
      border-radius: 999px;
      animation: spin .8s linear infinite;
    }
  </style>
</head>

<body class="text-slate-100 font-sans px-4">
  <div class="fixed inset-0 grid-overlay"></div>

  <!-- Toast -->
  <div id="toastWrap" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 w-[min(520px,92vw)] hidden">
    <div id="toast" class="toast-in glass rounded-2xl px-4 py-3 flex items-start gap-3">
      <div id="toastIcon" class="mt-0.5"></div>
      <div class="flex-1">
        <p id="toastTitle" class="font-semibold"></p>
        <p id="toastMsg" class="text-sm text-slate-300 mt-0.5"></p>
      </div>
      <button onclick="hideToast()" class="text-slate-400 hover:text-white transition" aria-label="Close toast">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7A1 1 0 0 0 5.7 7.11L10.59 12l-4.9 4.89a1 1 0 1 0 1.41 1.42L12 13.41l4.89 4.9a1 1 0 0 0 1.42-1.41L13.41 12l4.9-4.89a1 1 0 0 0 0-1.4z"/>
        </svg>
      </button>
    </div>
  </div>

  <main class="relative max-w-5xl mx-auto pt-10 pb-14">
    <!-- Header -->
    <header class="text-center mb-10">
      <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full glass">
        <span class="inline-flex items-center justify-center w-9 h-9 rounded-xl bg-blue-500/15 border border-blue-500/25 shadow-[0_0_35px_rgba(59,130,246,.25)]">
          <svg class="w-5 h-5 text-blue-300" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 1a5 5 0 0 0-5 5v3H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-9a2 2 0 0 0-2-2h-1V6a5 5 0 0 0-5-5Zm-3 8V6a3 3 0 0 1 6 0v3H9Z"/>
          </svg>
        </span>

        <div class="text-left leading-tight">
          <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300">CipherVault</span>
          </h1>
          <p class="text-[11px] sm:text-xs tracking-[0.28em] uppercase text-slate-400">
            zero-knowledge aes-256-gcm protection
          </p>
        </div>

        <span class="ml-2 hidden sm:inline-flex items-center gap-2 text-xs text-slate-300">
          <span class="w-2.5 h-2.5 rounded-full bg-emerald-400 shadow-[0_0_18px_rgba(16,185,129,.45)]"></span>
          Local vault
        </span>
      </div>

      <p class="mt-5 text-slate-300 max-w-2xl mx-auto text-sm sm:text-base">
        Store credentials encrypted on your machine. The server never stores your master password.
      </p>
    </header>

    <!-- Cards -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Store -->
      <div class="glass rounded-3xl p-6 sm:p-8">
        <div class="flex items-center justify-between border-b border-white/10 pb-4 mb-5">
          <div class="flex items-center gap-3">
            <span class="w-11 h-11 rounded-2xl bg-blue-500/12 border border-blue-500/25 flex items-center justify-center floaty">
              <span class="text-lg">üì•</span>
            </span>
            <div>
              <h2 class="text-lg sm:text-xl font-bold text-blue-200">Store Vault</h2>
              <p class="text-xs text-slate-400">Encrypt & save a new credential</p>
            </div>
          </div>
          <span class="text-[11px] px-2.5 py-1 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-200">
            AES-GCM
          </span>
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-xs uppercase tracking-widest text-slate-400 mb-2">Service</label>
            <input id="addService" type="text" placeholder="e.g., GitHub, Google"
              class="w-full bg-black/25 rounded-2xl px-4 py-3 ring-soft transition" />
          </div>

          <div>
            <label class="block text-xs uppercase tracking-widest text-slate-400 mb-2">Username / Email</label>
            <input id="addUsername" type="text" placeholder="user@example.com"
              class="w-full bg-black/25 rounded-2xl px-4 py-3 ring-soft transition" />
          </div>

          <div>
            <label class="block text-xs uppercase tracking-widest text-slate-400 mb-2">Password</label>
            <div class="relative">
              <input id="addPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                class="w-full bg-black/25 rounded-2xl px-4 py-3 pr-12 ring-soft transition" />
              <button class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition"
                onclick="toggleVisibility('addPassword', this)" aria-label="Toggle password visibility">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="pt-2">
            <label class="block text-xs uppercase tracking-widest text-blue-200 mb-2">Master Encryption Key</label>
            <div class="relative">
              <input id="addMaster" type="password" placeholder="Required to encrypt"
                class="w-full bg-blue-500/10 rounded-2xl px-4 py-3 pr-12 ring-soft transition border border-blue-500/20" />
              <button class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white transition"
                onclick="toggleVisibility('addMaster', this)" aria-label="Toggle master key visibility">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/>
                </svg>
              </button>
            </div>
            <p class="mt-2 text-[12px] text-slate-400">
              Tip: Use a long passphrase. This key is never stored.
            </p>
          </div>

          <button id="btnSave" onclick="saveEntry()"
            class="mt-2 w-full rounded-2xl py-3.5 font-extrabold tracking-widest uppercase
                   bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400
                   shadow-[0_0_40px_rgba(59,130,246,.25)] active:scale-[.99] transition flex items-center justify-center gap-3">
            <span id="saveSpinner" class="spinner hidden"></span>
            <span>Encrypt & Secure</span>
          </button>
        </div>
      </div>

      <!-- Unlock -->
      <div class="glass rounded-3xl p-6 sm:p-8">
        <div class="flex items-center justify-between border-b border-white/10 pb-4 mb-5">
          <div class="flex items-center gap-3">
            <span class="w-11 h-11 rounded-2xl bg-emerald-500/12 border border-emerald-500/25 flex items-center justify-center floaty">
              <span class="text-lg">üîç</span>
            </span>
            <div>
              <h2 class="text-lg sm:text-xl font-bold text-emerald-200">Unlock Vault</h2>
              <p class="text-xs text-slate-400">Decrypt & reveal stored password</p>
            </div>
          </div>
          <span class="text-[11px] px-2.5 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-200">
            Argon2id
          </span>
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-xs uppercase tracking-widest text-slate-400 mb-2">Service</label>
            <input id="getService" type="text" placeholder="e.g., github"
              class="w-full bg-black/25 rounded-2xl px-4 py-3 ring-soft ring-soft-green transition" />
          </div>

          <div class="pt-2">
            <label class="block text-xs uppercase tracking-widest text-emerald-200 mb-2">Master Decryption Key</label>
            <div class="relative">
              <input id="getMaster" type="password" placeholder="Required to decrypt"
                class="w-full bg-emerald-500/10 rounded-2xl px-4 py-3 pr-12 ring-soft ring-soft-green transition border border-emerald-500/20" />
              <button class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white transition"
                onclick="toggleVisibility('getMaster', this)" aria-label="Toggle master key visibility">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7Zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10Z"/>
                </svg>
              </button>
            </div>
          </div>

          <button id="btnGet" onclick="retrieveEntry()"
            class="mt-1 w-full rounded-2xl py-3.5 font-extrabold tracking-widest uppercase
                   bg-gradient-to-r from-emerald-600 to-teal-500 hover:from-emerald-500 hover:to-teal-400
                   shadow-[0_0_40px_rgba(16,185,129,.22)] active:scale-[.99] transition flex items-center justify-center gap-3">
            <span id="getSpinner" class="spinner hidden"></span>
            <span>Decrypt & Reveal</span>
          </button>

          <div id="resultBox" class="hidden mt-5 p-5 rounded-2xl bg-black/30 border border-white/10">
            <div class="flex items-center justify-between gap-3">
              <div>
                <p class="text-[11px] uppercase tracking-widest text-slate-400">Decrypted Password</p>
                <code id="decryptedPassword" class="block mt-2 text-xl sm:text-2xl text-white font-mono break-all selection:bg-blue-500/60"></code>
              </div>

              <div class="flex flex-col gap-2">
                <button onclick="copyDecrypted()"
                  class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm flex items-center gap-2">
                  <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm4 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h12v14Z"/>
                  </svg>
                  Copy
                </button>
                <button onclick="hideResult()"
                  class="px-3 py-2 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">
                  Hide
                </button>
              </div>
            </div>
          </div>

          <p class="text-[12px] text-slate-400">
            Service matching is case-insensitive (e.g., GitHub == github).
          </p>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-14 pt-10 border-t border-white/10 text-center">
      <p class="text-[11px] tracking-[0.35em] uppercase text-slate-400">
        Designed for Security by <span class="text-slate-100 font-semibold">Luminary</span>
      </p>

      <div class="mt-5 flex flex-wrap justify-center items-center gap-4">
        <!-- GitHub -->
        <a href="https://github.com/LuminaryX-X" target="_blank"
          class="w-11 h-11 rounded-2xl glass flex items-center justify-center text-slate-300 hover:text-white transition hover:scale-105"
          aria-label="GitHub">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"/>
          </svg>
        </a>

        <!-- Telegram -->
        <a href="https://t.me/Luminary_X_X" target="_blank"
          class="w-11 h-11 rounded-2xl glass flex items-center justify-center text-slate-300 hover:text-cyan-300 transition hover:scale-105"
          aria-label="Telegram">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.14-.24.24-.43.24l.213-3.03 5.495-4.96c.239-.213-.05-.331-.37-.12l-6.79 4.27-2.94-.92c-.64-.2-.65-.64.13-.95l11.49-4.43c.53-.19 1 .13.84.95z"/>
          </svg>
        </a>

        <!-- LinkedIn -->
        <a href="https://www.linkedin.com/in/umar-fayzullayev-12a05b333" target="_blank"
          class="w-11 h-11 rounded-2xl glass flex items-center justify-center text-slate-300 hover:text-blue-300 transition hover:scale-105"
          aria-label="LinkedIn">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
        </a>

        <!-- Email -->
        <a href="mailto:umarfayzullayev208@gmail.com"
          class="w-11 h-11 rounded-2xl glass flex items-center justify-center text-slate-300 hover:text-red-300 transition hover:scale-105"
          aria-label="Email">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
          </svg>
        </a>
      </div>

      <p class="mt-5 text-[12px] text-slate-500">
        ¬© <span id="year"></span> CipherVault ‚Äî local encrypted storage.
      </p>
    </footer>
  </main>

  <script>
    document.getElementById('year').innerText = new Date().getFullYear();

    let toastTimer = null;

    function showToast(title, msg, type = "success") {
      const wrap = document.getElementById('toastWrap');
      const icon = document.getElementById('toastIcon');
      const tTitle = document.getElementById('toastTitle');
      const tMsg = document.getElementById('toastMsg');

      const successIcon = `
        <div class="w-9 h-9 rounded-2xl bg-emerald-500/15 border border-emerald-500/25 flex items-center justify-center">
          <svg class="w-5 h-5 text-emerald-300" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/>
          </svg>
        </div>`;
      const errorIcon = `
        <div class="w-9 h-9 rounded-2xl bg-red-500/15 border border-red-500/25 flex items-center justify-center">
          <svg class="w-5 h-5 text-red-300" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 14h-2v-2h2v2Zm0-4h-2V6h2v6Z"/>
          </svg>
        </div>`;

      icon.innerHTML = (type === "success") ? successIcon : errorIcon;
      tTitle.textContent = title;
      tMsg.textContent = msg;

      wrap.classList.remove('hidden');

      if (toastTimer) clearTimeout(toastTimer);
      toastTimer = setTimeout(hideToast, 4500);
    }

    function hideToast() {
      document.getElementById('toastWrap').classList.add('hidden');
    }

    function toggleVisibility(inputId, btn) {
      const el = document.getElementById(inputId);
      el.type = (el.type === "password") ? "text" : "password";
      // optional tiny visual feedback
      btn.classList.add('scale-95');
      setTimeout(() => btn.classList.remove('scale-95'), 120);
    }

    function setLoading(btnId, spinnerId, isLoading) {
      const btn = document.getElementById(btnId);
      const sp = document.getElementById(spinnerId);
      if (isLoading) {
        btn.setAttribute('disabled', 'true');
        btn.classList.add('opacity-80', 'cursor-not-allowed');
        sp.classList.remove('hidden');
      } else {
        btn.removeAttribute('disabled');
        btn.classList.remove('opacity-80', 'cursor-not-allowed');
        sp.classList.add('hidden');
      }
    }

    function hideResult(){
      document.getElementById('resultBox').classList.add('hidden');
      document.getElementById('decryptedPassword').innerText = "";
    }

    async function copyDecrypted(){
      const text = document.getElementById('decryptedPassword').innerText || "";
      if (!text) return showToast("Nothing to copy", "Decrypt a password first.", "error");
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied", "Password copied to clipboard.", "success");
      }catch(e){
        showToast("Copy blocked", "Your browser blocked clipboard access.", "error");
      }
    }

    async function saveEntry() {
      const data = {
        service: document.getElementById('addService').value.trim(),
        username: document.getElementById('addUsername').value.trim(),
        password: document.getElementById('addPassword').value,
        master_password: document.getElementById('addMaster').value
      };

      if (!data.service || !data.password || !data.master_password) {
        showToast("Missing fields", "Service, password and master key are required.", "error");
        return;
      }

      setLoading("btnSave", "saveSpinner", true);

      try {
        const response = await fetch('/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const res = await response.json().catch(() => ({}));

        if (response.ok) {
          showToast("Saved", res.message || "Credential stored securely.", "success");
          document.getElementById('addService').value = '';
          document.getElementById('addUsername').value = '';
          document.getElementById('addPassword').value = '';
          document.getElementById('addMaster').value = '';
        } else {
          showToast("Error", res.detail || "Failed to save entry.", "error");
        }
      } catch (err) {
        showToast("Server unreachable", "Could not connect to API.", "error");
      } finally {
        setLoading("btnSave", "saveSpinner", false);
      }
    }

    async function retrieveEntry() {
      const service = document.getElementById('getService').value.trim();
      const master_password = document.getElementById('getMaster').value;
      const resultBox = document.getElementById('resultBox');
      const passDisplay = document.getElementById('decryptedPassword');

      if (!service || !master_password) {
        showToast("Missing fields", "Service and master key are required.", "error");
        return;
      }

      setLoading("btnGet", "getSpinner", true);
      hideResult();

      try {
        const response = await fetch(`/get/${encodeURIComponent(service)}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ master_password })
        });

        const res = await response.json().catch(() => ({}));

        if (response.ok) {
          passDisplay.innerText = res.password || "";
          resultBox.classList.remove('hidden');
          showToast("Decrypted", `Credentials unlocked for "${service}".`, "success");
          document.getElementById('getMaster').value = '';
        } else {
          showToast("Denied", res.detail || "Failed to decrypt.", "error");
        }
      } catch (err) {
        showToast("Server unreachable", "Could not connect to API.", "error");
      } finally {
        setLoading("btnGet", "getSpinner", false);
      }
    }
  </script>
</body>
</html>